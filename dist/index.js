!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.dpack=r():e.dpack=r()}(window,function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s="./browser.js")}({"./browser.js":
/*!********************!*\
  !*** ./browser.js ***!
  \********************/
/*! no static exports found */function(e,r,t){var n=t(/*! ./lib/serialize */"./lib/serialize.js"),o=t(/*! ./lib/parse */"./lib/parse.js"),i=t(/*! ./lib/Options */"./lib/Options.js").Options;r.serialize=n.serialize,r.parse=o.parse,r.createSerializer=n.createSerializer,r.createParser=o.createParser,r.Options=i,r.fetch=t(/*! ./fetch */"./fetch.js").fetch,r.XMLHttpRequest=t(/*! ./xhr */"./xhr.js").XMLHttpRequest},"./fetch.js":
/*!******************!*\
  !*** ./fetch.js ***!
  \******************/
/*! no static exports found */function(e,r,t){"use strict";var n=t(/*! ./lib/parse */"./lib/parse.js").createParser;t(/*! ./lib/serialize */"./lib/serialize.js").serialize;function o(e,r){var t=e.body.getReader();return new Promise(function(e,r){var o,i,a;function s(e){var r=e.length,t=r-1;if(e[t]<128)return a=null,e;for(;t>=0;){var n=e[t];if(n>=192){var o=(n>=224?n>=240?4:3:2)-r+t;return o>0?((a=e.slice(t,r-t)).needs=o,e.slice(0,t)):(a=null,e)}t--}return a=null,e}var u=new TextDecoder;!function r(){t.read().then(function(t){if(t.done)e(i);else{var f,l=t.value;if(a?(f=u.decode(new Uint8Array(Array.from(a).concat(Array.from(l.slice(0,a.needs))))),l=s(l=l.slice(a.needs)),f+=u.decode(l)):(l=s(l),f=u.decode(l)),o){if(o.onResume){var c=o.onResume(f,!0);i=i||c}}else(o=n()).setSource(f,0,!0),i=o.read();o.read(),r()}})}()})}r.readResponse=o,r.fetch=function(e,r){(r.headers||(r.headers={})).Accept="text/dpack;q=1,application/json;q=0.7";var t=fetch(e,r);return t.then(function(e){return e.dpack=function(r){return o(e)},e}),t}},"./lib/Options.js":
/*!************************!*\
  !*** ./lib/Options.js ***!
  \************************/
/*! no static exports found */function(e,r,t){"use strict";function n(){this.classByName=new Map;this.converterByConstructor=new Map}n.prototype.addExtension=function(e,r,t){r&&e.name!==r&&(e.name=r),this.classByName.set(e.name,t&&t.fromArray?t:e),this.converterByConstructor.set(e,t&&t.toArray?t:e)},r.Options=n},"./lib/parse.js":
/*!**********************!*\
  !*** ./lib/parse.js ***!
  \**********************/
/*! no static exports found */function(e,r,t){"use strict";var n=3,o=4,i=6,a=7,s=8,u=9,f=11,l=13,c=14,d=12,p=14,y=15;function h(e){var r,t,h;e||(e={});var m,w,j=e.classByName||new Map;function S(e,n){if(e.previous=m,e.resume=!0,m=e,!h)throw new Error("Unexpected end of dpack stream");return x.onResume||(x.onResume=function(e,o,i){var a=m;return m=null,x.onResume=null,t=n<t.length?t.slice(n)+e:i?e.slice(0,1)+e.slice(1):e,h=o,P+=n,r=0,a.reader?a.reader(a):k(a.length,a)}),e.object}function k(h,v){var g,b,P,C=0,z=0,T=0;if((v=v||[]).resume){if(g=v.previous){var O=g.reader?g.reader(g):k(g.length,g);(q=g.values)&&(m?m.values=q:O.nextPosition>-1?q[q.nextPosition++]=O:q.push(O))}v.code&&v.code!==v.thisProperty.code?v.resume=!1:(z=v.i||0,P=v.object,C=v.propertyState||0,T=v.propertyIndex||0,v=v.thisProperty)}for(b=v.code===a,P=P||(v.constructs?new v.constructs:b?[]:{});z<h;){var A,R,V=r,M=t.charCodeAt(r++);if(M>=48)M>12288?(A=M>>>12^4,R=4095&M):(A=M>>>4^4,R=15&M);else if(A=M>>>4&11,R=((R=15&M)<<6)+(63&(M=t.charCodeAt(r++))),!(M>=64||(R=(R<<6)+(63&(M=t.charCodeAt(r++))),M>=64||(R=(R<<6)+(63&(M=t.charCodeAt(r++))),M>=64||(R=(R<<6)+(63&(M=t.charCodeAt(r++))),M>=64||(R=64*R+(63&(M=t.charCodeAt(r++))),M>=64||(R=64*R+(63&(M=t.charCodeAt(r++))),M>=64||(R=64*R+(63&(M=t.charCodeAt(r++))),M>=0||!(r>t.length)))))))))return S({length:h,thisProperty:v,i:z,object:P,propertyIndex:T,propertyState:C},V);if(0!==A){if(g=v[T],3===A){if(!(R<6)){if(R<=u){if(1===C&&(z++,g=v[++T]),T<v.resetTo)throw new Error("Overwriting frozen property");g?g.resume||(O=g.key,(g=v[T]=[]).key=O):(g=v[T]=[]).key=null,g.code=R,g.parent=v,C=2,R===s?g.values=[]:R===a&&(g[0]=[],g[0].key=null,g[0].code=i,g[0].parent=g)}else C=R;continue}O=R<3?0===R?null:"Unknown token, type: "+A+" number: "+R:R===o||R!==n&&void 0}else if(2===A){if(O=t.slice(r,r+=R),r>t.length)return S({length:h,thisProperty:v,i:z,object:P,propertyIndex:T,propertyState:C},V);C<2&&g.code===u&&(O=+O)}else if(1===A)O=R;else if(R>13){if(R===p)return P;R===y&&(O=k(0,g),C=0,e.forDeferred?O=e.forDeferred(O,g):(w||(w=[])).push({property:g,value:O}))}else if(R>=d&&(R=2e9),C>1?2===C?(C=0,O=k(R,g)):O=C===f?k(R,[{key:null,code:6}]):g.resume&&(g.code||i)===g.thisProperty.code?k(R,g.thisProperty):k(R,g):O=k(R,g),m){if(void 0===O)return m=null,x.onResume=null,S({length:h,thisProperty:v,i:z,object:P,property:g,propertyIndex:T,previousProperty:previousProperty,propertyState:C},V);m.values=q}if(!g)throw new Error("No property defined for slot"+(v.key?" in "+v.key:""));if(C<2&&g&&g.code===s){var q=g.values;if("number"==typeof O){if(void 0===(O=q[R])&&!(R in q))throw new Error("Referencing value that has not been read yet")}else 2!==A&&7!==A||!q||(q.nextPosition>-1?(g.recordValueReference&&g.recordValueReference(q),q[q.nextPosition++]=O):q.push(O))}if(C>1){if(2===C)g.key=O;else if(C===f)if("string"==typeof O){var E=j.get(O);if(E)E.fromValue?g.fromValue=E.fromValue:g.constructs=E;else if(e.errorOnUnknownClass)throw new Error("Attempt to deserialize to unknown class "+parameter);g.extendedType=E}else g.metadata=O;else if(C===l){(q=g.values||(g.values=[])).nextPosition=O}else if(C!==c)throw new Error("Unknown property type "+C);C=1}else C=0,g.fromValue&&(O=g.fromValue(O)),b&&null===g.key?P.push(O):void 0!==O&&(P[g.key]=O),z++,b||T++}else T=R,C=0}return P}j.set("Map",v),j.set("Set",g),j.set("Date",b);var P=0;var x={setSource:function(e,n,o){return t=e,r=n||0,P=0,h=o,this},hasMoreData:function(){return t.length>r},isPaused:function(){return m},hasUnfulfilledReferences:function(){return w&&w.length>w.index},getOffset:function(){return r+P},read:function n(o){try{if(o&&o.resume){var i=o.previous;a=k(i.length,i),a=o.object||a,o=o.property}else var a=k(1,o=o||[e&&e.shared||{key:null,code:6}])[o[0].key];for(;;){if(m)return S({reader:n,object:a,property:o});if(!w)return a;var s=w.index||0,u=w[s];if(w.index=s+1,u){var f=u.value,l=w;(w=[]).parent=l;var c=u.property,d=k(1,o=[{resume:!0,key:null,thisProperty:c,object:f}]);(d=d.null||d[c.key])!=f&&(Object.assign(f,d),m&&m.object===d&&(m.object=f),d&&d.constructor===Array&&(f.length=d.length,Object.setPrototypeOf(f,Object.getPrototypeOf(d))))}else w=w.parent}}catch(e){throw e.message="DPack parsing error: "+e.message+" at position: "+(r+P)+" near: "+t.slice(r-10,r+10),e}}};return x}r.parse=function(e,r){var t;if("string"==typeof e)t=e;else{if(!e||!e.toString)return e;t=e.toString(r&&r.encoding||"utf8")}var n=h(r).setSource(t);return r&&r.shared?n.read([r.shared]):n.read()},r.createParser=h;var v={fromValue:function(e){for(var r=new Map,t=0,n=e.length;t<n;t++){var o=e[t];r.set(o.key,o.value)}return r}},g={fromValue:function(e){var r=new Set(e);if(0===r.size&&e.length>0)for(var t=0,n=e.length;t<n;t++)r.add(e[t]);return r}},b={fromValue:function(e){return new Date(e)}}},"./lib/serialize.js":
/*!**************************!*\
  !*** ./lib/serialize.js ***!
  \**************************/
/*! no static exports found */function(e,r,t){"use strict";(function(e){var t=0,n=3,o=2,i=1,a=7,s=0,u=3,f=4,l=5,c=6,d=7,p=8,y=9,h=11,v=13,g=12,b=14,m=15,w=1;function j(j){j||(j={});var S=j.converterByConstructor;S||(S=new Map),S.set(Map,{name:"Map",toValue:k}),S.set(Set,{name:"Set",toValue:P}),S.set(Date,{name:"Date",toValue:x});j.outlet||j.avoidShareUpdate;var C,z=void 0===e||!e.Buffer||j&&"utf16le"===j.encoding?function(){var e="";function r(r,t){var n;if(t<16)n=String.fromCharCode(64^(r<<4|t));else if(t<1024)n=String.fromCharCode((r<<4)+(t>>>6),64+(63&t));else if(t<65536)n=String.fromCharCode((r<<4)+(t>>>12),t>>>6&63,64+(63&t));else if(t<4194304)n=String.fromCharCode((r<<4)+(t>>>18),t>>>12&63,t>>>6&63,64+(63&t));else if(t<268435456)n=String.fromCharCode((r<<4)+(t>>>24),t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else if(t<4294967296)n=String.fromCharCode((r<<4)+(t>>>30),t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else if(t<17179869184)n=String.fromCharCode((r<<4)+(t/1073741824>>>0),t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else if(t<1099511627776)n=String.fromCharCode((r<<4)+(t/68719476736>>>0),t/1073741824&63,t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else{if(!(t<70368744177664))throw new Error("Too big of number");n=String.fromCharCode((r<<4)+(t/4398046511104>>>0),t/68719476736&63,t/1073741824&63,t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t))}e+=n}return{writeToken:r,writeString:function(r){e+=r},getSerialized:function(){return e},startSequence:function(){r(a,g)},endSequence:function(){r(a,b)},getOffset:function(){return-1}}}():r.nodeCharEncoder(j),T=z.writeString,O=z.writeToken,A=z.startSequence,R=z.endSequence,V=z.writeBuffer;j.forProperty;j.shared&&(C=j.shared.propertyUsed,j.shared.propertyUsed);var M,q=[],E=r.bufferSymbol||"_bufferSymbol_",B=r.targetSymbol||"_targetSymbol_",U=w++,_=[0,1,2,3,4,5,I,X,H,L,function(){O(n,s)}];function D(e){O(o,e.length),T(e)}function H(e){var r,t=M.values;if(t){t.resetTo>-1&&t.serializer!==U&&(t.serializer=U,t.resetTo<t.length&&(t.length=t.resetTo),O(n,v),O(i,t.resetTo));var o=t.indexOf(e);if(o>-1)return function(e){O(i,e)}(o)}if("string"==(r=typeof e)||"object"===r&&e)if(M.writeSharedValue){if(M.writeSharedValue(e,O,U))return}else if(t){var a=t.length;a<12&&(t[a]=e)}"string"===r?D(e):I(e)}function L(e){var r=typeof e;"number"===r?e>>>0===e||e>0&&e<70368744177664&&e%1==0?O(i,e):D(e.toString()):"object"===r?I(e):W(e)}function W(e){null===e?O(n,s):!1===e?O(n,u):!0===e?O(n,f):void 0===e?O(n,l):function(e){var r,t=typeof e;if("object"===t)if(e){var o=e.constructor;if(o===Object);else if(o===Array)t="array";else if((r=S.get(o))&&r.toValue){if(e=r.toValue(e),t=typeof e,e&&"object"===t&&e.constructor===Array&&(t="array"),M.type===t)return M.extendedType!==r&&(M.extendedType=r,O(n,h),D(r.name)),_[M.code](e)}else r=!1}else t="undefined";else"boolean"===t?t="undefined":"function"===t&&(e=e.toString(),t="string");M=N(null,t,r),_[M.code](e)}(e)}function I(e,r){var o=typeof e;if("object"!==o)return"string"===o?D(e):"number"===o&&(e>>>0===e||e>0&&e<70368744177664&&e%1==0)?O(i,e):W(e);if(!e)return O(n,s);var u,f=e,l=f.constructor;if(f[B])return F(e);if(l===Object)u=!1;else{if(l===Array)return M=N(M.key,"array"),_[M.code](e,r);if(f.then)return F(e);if(g=S.get(l)){if(g.toValue)return W(f)}else S.set(l,g={name:l.name});M.constructs!==l&&(O(n,h),D(g.name),M.constructs=l),"undefined"!=typeof Symbol&&f[Symbol.iterator]&&(N(M.key,"array"),function(e){O(a,15);var r,t=e[Symbol.iterator](),n=M;M=n.child||(n.child=n);for(;!(r=t.next()).done;)_[M.code](r.value,n);M!==n.child&&(n.child=M);M=n,O(a,b)}(f)),u=!0}var c=M;c.resetTo<c.length&&c.serializer!=U&&(c.length=c.resetTo,c.serializer=U),A();var d=0,p=-2,y=0;for(var v in f)if(!u||f.hasOwnProperty(v)){o=typeof(e=f[v]),M=c[y];var g=!1;if("object"===o&&(e?(l=e.constructor)===Object||(l===Array?o="array":(g=S.get(l))&&g.toValue?(o=typeof(e=g.toValue(e)),e&&"object"===o&&e.constructor===Array&&(o="array")):g=!1):o="undefined"),!M||M.key!==v||M.type!==o&&"boolean"!==o&&"undefined"!==o&&("string"!==o||"number"===M.type)||g&&M.extendedType!==l){var m=y;p>-2&&(y=p);do{M=c[++y]}while(M&&(M.key!==v||M.type!==o&&"boolean"!==o&&"undefined"!==o&&("string"!==o||"number"===M.type)||g&&M.extendedType!==l));if(M)O(t,y),-2===p&&(p=m-1);else if(c.getProperty)m!==(y=(M=c.getProperty(e,v,o,g,N,O,m)).index)&&-2===p&&(p=m-1);else{if(m===c.length?y=m:(O(t,y=c.length),-2===p&&(p=m-1)),y<c.resetTo)throw new Error("overwriting frozen property");M=c[y]=N(v,o,g)}}C&&C(M,f,U,d);var w=M.code;w>7?8===w?H(e):L(e):6===w?I(e):X(e),y++,d++}M=c,R(d)}function N(e,r,t){var o;return(o=[]).key=e,o.type=r,"string"===r?(O(n,p),o.values=[],o.code=p):"number"===r?(O(n,y),o.code=y):"object"===r?(O(n,c),o.code=c):"array"===r?(O(n,d),o.code=d):"boolean"===r||"undefined"===r?(o.type="object",O(n,c),o.code=c):(O(n,c),o.code=10,console.error("Unable to write value of type "+r)),"string"==typeof e?D(e):(null!==e||"object"!==r&&"array"!==r)&&I(e),t&&(o.extendedType=t,O(n,h),D(t.name)),o}function X(e,r){if(e){if(e[B])return F(e);if(e.constructor===Array){var n,o=e.length;o>11?(O(a,g),n=!0):O(a,o);var i=M;M=i[0],i.resetTo<i.length&&i.serializer!=U&&(i.length=i.resetTo,i.serializer=U);for(var s=0,u=0;u<o;u++){var f=e[u],l=typeof f;if("object"===l)if(f){var d=f.constructor;if(d===Object);else if(d===Array)l="array";else{var p=S.get(d);p&&p.toValue?(l=typeof(f=p.toValue(f)),f&&"object"===l&&f.constructor===Array&&(l="array")):p=!1}}else l="undefined";if(M){if(M.type!==l&&"boolean"!==l&&"undefined"!==l&&("string"!==l||"number"===M.type)||p&&M.extendedType!==d){s=-1;do{M=i[++s]}while(M&&(M.type!==l&&"boolean"!==l&&"undefined"!==l&&("string"!==l||"number"===M.type)||p&&M.extendedType!==d));M?O(t,s):i.getProperty?M=i.getProperty(f,null,l,p,N,O,-1):(O(t,s),M=N(null,l,p),i[s]=M)}}else i.getProperty?M=i.getProperty(f,null,l,p,N,O,0):("string"===l||"number"===l||"array"===l?M=N(null,l,p):((M=[]).type=l,M.key=null,M.code=c),i[0]=M);C&&C(M,e,U,u);var y=M.code;y>7?8===y?H(f):L(f):6===y?I(f):X(f)}n&&O(a,b),M=i}else W(e)}else W(e)}function F(e,r){O(a,m);var t=M,n=e[B]?{then:o}:{then:function(r){return e.then(function(t){e=t,o(r)})}};function o(r){if(j.forBlock)j.forBlock(e,t);else{var n=e&&e[E]&&e[E](t);if(n)V(n);else{M=t;var o=q;q=[],I(e),o.unshift.apply(o,q),q=o}}r()}q.push(n)}var G={serialize:function(e,r){var t=e&&e[E]&&e[E](r);t?z.writeBuffer(t):r?_[(M=r).code](e):((M=[]).key=null,I(e))},getSerialized:function(){if(q.length>0){for(var e=[];q.length>0;){var r=!1,t=q.shift().then(function(){r=!0});r||e.push(t)}if(e.length>0)return Promise.all(e).then(function(){return G.getSerialized()})}return j&&"utf16le"===j.encoding?Buffer.from(z.getSerialized(),"utf16le"):z.getSerialized()},flush:z.flush,setOffset:z.setOffset,pendingEncodings:q,getWriters:function(){return{writeProperty:N,writeToken:O,writeAsDefault:I,writeBuffer:V}}};return G}r.serialize=function(e,t){var n,o=j(t),i=t&&t.shared;i&&i.startWrite&&i.startWrite(t.avoidShareUpdate,e),o.serialize(e,i),n=o.getSerialized(),i&&i.endWrite&&i.endWrite(t.avoidShareUpdate,e);var a=e&&e[r.sizeTableSymbol];return a&&(n.sizeTable=a),t&&t.lazy?Buffer.concat([e[r.sizeTableSymbol],n]):n},r.createSerializer=j;var S=Array.from||function(e,r){var t=[];r=e.constructor===Map;return e.forEach(function(e,n){r?t.push([n,e]):t.push(e)}),t};function k(e){for(var r=S(e),t=0,n=r.length;t<n;t++){var o=r[t];r[t]={key:o[0],value:o[1]}}return r}function P(e){return S(e)}function x(e){return e.getTime()}}).call(this,t(/*! ./../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */function(e,r){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},"./xhr.js":
/*!****************!*\
  !*** ./xhr.js ***!
  \****************/
/*! no static exports found */function(e,r,t){"use strict";var n=t(/*! ./lib/parse */"./lib/parse.js").createParser;r.XMLHttpRequest=function(){var e,r,t=new XMLHttpRequest;t.addEventListener("progress",s);var o=t.setRequestHeader,i=0;t.setRequestHeader=function(e,t){return"accept"==e.toLowerCase()&&(r=!0),o.call(this,e,t)};var a=t.send;function s(r){var o=t.responseText;try{if(e){if(e.onResume){var a=e.onResume(o.slice(i),!0,!0);t.responseParsed=t.responseParsed||a}}else{if(!o||!/dpack/.test(t.getResponseHeader("Content-Type")))return;(e=n()).setSource(o,0,!0),t.responseParsed=e.read()}i=o.length}catch(e){if(!t.onerror)throw e;t.onerror(e)}}return t.send=function(){r||this.setRequestHeader("Accept","text/dpack;q=1,application/json;q=0.7"),a.apply(this,arguments)},t.addEventListener("load",function(r){if(s(),e&&e.isPaused())throw new Error("Unexpected end of dpack stream")}),t}}})});
//# sourceMappingURL=index.js.map